<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°„æ“ŠéŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #87CEEB 0%, #B0D8F0 50%, #98D8C8 100%);
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.9);
            z-index: 10;
            background: rgba(0,0,0,0.3);
            padding: 15px 25px;
            border-radius: 15px;
        }

        #crosshair {
            position: absolute;
            width: 50px;
            height: 50px;
            pointer-events: none;
            z-index: 100;
            transform: translate(-25px, -25px);
            transition: all 0.05s ease-out;
        }

        .crosshair-center {
            position: absolute;
            width: 4px;
            height: 4px;
            left: 23px;
            top: 23px;
            background: red;
            border-radius: 50%;
            box-shadow: 0 0 5px red, 0 0 10px red;
        }

        .crosshair-line {
            position: absolute;
            background: rgba(255, 0, 0, 0.8);
            box-shadow: 0 0 3px rgba(255, 0, 0, 0.8);
        }

        .crosshair-h1 {
            width: 15px;
            height: 2px;
            left: 3px;
            top: 24px;
        }

        .crosshair-h2 {
            width: 15px;
            height: 2px;
            right: 3px;
            top: 24px;
        }

        .crosshair-v1 {
            width: 2px;
            height: 15px;
            left: 24px;
            top: 3px;
        }

        .crosshair-v2 {
            width: 2px;
            height: 15px;
            left: 24px;
            bottom: 3px;
        }

        .crosshair-circle {
            position: absolute;
            width: 40px;
            height: 40px;
            left: 5px;
            top: 5px;
            border: 2px solid rgba(255, 0, 0, 0.6);
            border-radius: 50%;
        }

        #gun {
            position: absolute;
            bottom: -20px;
            right: 5%;
            width: 350px;
            height: 250px;
            z-index: 50;
            pointer-events: none;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
        }

        .muzzle-flash {
            position: absolute;
            bottom: 120px;
            right: 8%;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 45;
            opacity: 0;
        }

        .muzzle-flash.active {
            animation: flash 0.1s ease-out;
        }

        @keyframes flash {
            0% { opacity: 1; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(1.5); }
        }

        #endScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 200;
        }

        #endScreen.show {
            display: flex;
        }

        .end-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        }

        .end-content h1 {
            color: white;
            margin-bottom: 20px;
            font-size: 42px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .score-display {
            font-size: 56px;
            color: #FFD700;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .stars {
            font-size: 70px;
            margin: 30px 0;
        }

        .star {
            color: #555;
            display: inline-block;
            margin: 0 8px;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
        }

        .star.filled {
            color: #FFD700;
            animation: starPop 0.5s ease;
            filter: drop-shadow(0 0 15px #FFD700);
        }

        @keyframes starPop {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.4) rotate(360deg); }
        }

        #restartBtn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 26px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        #restartBtn:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 300;
        }

        #startBtn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 25px 70px;
            font-size: 36px;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }

        #startBtn:hover {
            transform: scale(1.15) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .start-title {
            color: white;
            font-size: 64px;
            margin-bottom: 20px;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
        }

        .start-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 22px;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hit-effect {
            position: absolute;
            color: #ff4444;
            font-size: 42px;
            font-weight: bold;
            animation: hitAnim 0.6s ease-out;
            pointer-events: none;
            z-index: 150;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        @keyframes hitAnim {
            0% { opacity: 1; transform: scale(1) translateY(0); }
            100% { opacity: 0; transform: scale(2) translateY(-50px); }
        }

        .miss-effect {
            position: absolute;
            color: rgba(255,255,255,0.6);
            font-size: 24px;
            font-weight: bold;
            animation: missAnim 0.4s ease-out;
            pointer-events: none;
            z-index: 150;
        }

        @keyframes missAnim {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5); }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui">
        <div>ğŸ¯ å¾—åˆ†: <span id="score">0</span></div>
        <div>â±ï¸ æ™‚é–“: <span id="timer">30</span>ç§’</div>
    </div>

    <div id="crosshair">
        <div class="crosshair-circle"></div>
        <div class="crosshair-line crosshair-h1"></div>
        <div class="crosshair-line crosshair-h2"></div>
        <div class="crosshair-line crosshair-v1"></div>
        <div class="crosshair-line crosshair-v2"></div>
        <div class="crosshair-center"></div>
    </div>

    <div class="muzzle-flash" id="muzzleFlash">
        <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" fill="yellow" opacity="0.9"/>
            <circle cx="50" cy="50" r="30" fill="orange" opacity="0.8"/>
            <circle cx="50" cy="50" r="20" fill="red" opacity="0.7"/>
            <polygon points="50,10 55,40 50,30 45,40" fill="yellow" opacity="0.9"/>
            <polygon points="90,50 60,55 70,50 60,45" fill="yellow" opacity="0.9"/>
            <polygon points="50,90 45,60 50,70 55,60" fill="yellow" opacity="0.9"/>
            <polygon points="10,50 40,45 30,50 40,55" fill="yellow" opacity="0.9"/>
        </svg>
    </div>

    <svg id="gun" viewBox="0 0 350 250">
        <defs>
            <linearGradient id="gunGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#2c2c2c;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#1a1a1a;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="barrelGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#0d0d0d;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#3a3a3a;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#0d0d0d;stop-opacity:1" />
            </linearGradient>
        </defs>
        
        <g transform="translate(50, 80)">
            <path d="M 0 80 L 0 120 Q 0 140 -20 150 L -40 145 Q -45 135 -40 120 L -30 90 Q -25 80 0 80 Z" 
                  fill="url(#gunGrad)" stroke="#0d0d0d" stroke-width="2"/>
            <path d="M 40 70 L 40 110 Q 40 120 30 130 L 15 135 Q 5 135 0 125 L 0 80 Q 5 70 15 70 L 40 70 Z" 
                  fill="url(#gunGrad)" stroke="#0d0d0d" stroke-width="2"/>
            <rect x="10" y="75" width="25" height="8" fill="#8B4513" rx="2"/>
            <ellipse cx="45" cy="85" rx="12" ry="18" fill="none" stroke="#0d0d0d" stroke-width="3"/>
            <rect x="42" y="85" width="6" height="15" fill="#c0392b" rx="2" stroke="#8B0000" stroke-width="1"/>
            <rect x="40" y="45" width="120" height="35" fill="url(#gunGrad)" stroke="#0d0d0d" stroke-width="2" rx="4"/>
            <rect x="60" y="80" width="30" height="45" fill="#2c2c2c" stroke="#0d0d0d" stroke-width="2" rx="3"/>
            <rect x="65" y="85" width="20" height="35" fill="#1a1a1a" rx="2"/>
            <rect x="160" y="52" width="140" height="20" fill="url(#barrelGrad)" stroke="#0d0d0d" stroke-width="2" rx="2"/>
            <ellipse cx="300" cy="62" rx="8" ry="10" fill="#0d0d0d"/>
            <ellipse cx="300" cy="62" rx="5" ry="7" fill="#000000"/>
            <rect x="280" y="48" width="3" height="8" fill="#FFD700"/>
            <circle cx="281.5" cy="52" r="2" fill="#FFD700"/>
            <rect x="100" y="35" width="60" height="8" fill="#1a1a1a" stroke="#0d0d0d" stroke-width="1" rx="2"/>
            <line x1="160" y1="58" x2="280" y2="58" stroke="#4a4a4a" stroke-width="1"/>
            <line x1="160" y1="66" x2="280" y2="66" stroke="#4a4a4a" stroke-width="1"/>
            <circle cx="70" cy="57" r="2.5" fill="#4a4a4a" stroke="#2c2c2c" stroke-width="1"/>
            <circle cx="140" cy="57" r="2.5" fill="#4a4a4a" stroke="#2c2c2c" stroke-width="1"/>
            <circle cx="200" cy="58" r="2" fill="#4a4a4a"/>
            <circle cx="240" cy="58" r="2" fill="#4a4a4a"/>
            <rect x="170" y="56" width="3" height="12" fill="#0d0d0d" rx="1"/>
            <rect x="180" y="56" width="3" height="12" fill="#0d0d0d" rx="1"/>
            <rect x="190" y="56" width="3" height="12" fill="#0d0d0d" rx="1"/>
        </g>
    </svg>

    <div id="startScreen">
        <h1 class="start-title">ğŸ¯å°„æ“ŠéŠæˆ²</h1>
        <p class="start-subtitle">ğŸ² ç¥ç§˜åˆ†æ•¸æŒ‘æˆ°ï¼<br>å°„æ“Šå‰ä¸çŸ¥é“æ˜¯åŠ åˆ†é‚„æ˜¯æ‰£åˆ†<br>åªæœ‰æ“Šä¸­å¾Œæ‰æœƒçŸ¥é“çµæœï¼<br>ç§»å‹•æº–æ˜Ÿç„æº–ç›®æ¨™ï¼Œé»æ“Šå°„æ“Šï¼<br>30ç§’å…§ç›¡å¯èƒ½ç²å¾—é«˜åˆ†ï¼</p>
        <button id="startBtn">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="endScreen">
        <div class="end-content">
            <h1>ğŸ† éŠæˆ²çµæŸï¼ğŸ†</h1>
            <div class="score-display">å¾—åˆ†: <span id="finalScore">0</span></div>
            <div class="stars">
                <span class="star" id="star1">â˜…</span>
                <span class="star" id="star2">â˜…</span>
                <span class="star" id="star3">â˜…</span>
            </div>
            <button id="restartBtn">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const crosshair = document.getElementById('crosshair');
        const gun = document.getElementById('gun');
        const muzzleFlash = document.getElementById('muzzleFlash');

        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let targets = [];
        let animationId;
        let mouseX = canvas.width / 2;
        let mouseY = canvas.height / 2;
        let hasMoved = false;

        // åˆå§‹åŒ–æº–æ˜Ÿä½ç½®
        crosshair.style.left = mouseX + 'px';
        crosshair.style.top = mouseY + 'px';

        // æ»‘é¼ ç§»å‹• - æº–æ˜Ÿè·Ÿéš¨
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            crosshair.style.left = mouseX + 'px';
            crosshair.style.top = mouseY + 'px';
        });

        // è§¸æ§é–‹å§‹ - è¨˜éŒ„ï¼Œä½†ä¸ç§»å‹•æº–æ˜Ÿ
        document.addEventListener('touchstart', (e) => {
            hasMoved = false;
        });

        // è§¸æ§ç§»å‹• - åªåœ¨æ‹–æ›³æ™‚ç§»å‹•æº–æ˜Ÿ
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
            hasMoved = true;
            const touch = e.touches[0];
            mouseX = touch.clientX;
            mouseY = touch.clientY;
            crosshair.style.left = mouseX + 'px';
            crosshair.style.top = mouseY + 'px';
        }, { passive: false });

        // è§¸æ§çµæŸ - å¦‚æœæ²’æ‹–æ›³å°±å°„æ“Š
        document.addEventListener('touchend', (e) => {
            if (!gameActive) return;
            
            // åªæœ‰åœ¨æ²’æ‹–æ›³çš„æƒ…æ³ä¸‹æ‰å°„æ“Š
            if (!hasMoved) {
                const rect = canvas.getBoundingClientRect();
                const clickX = mouseX - rect.left;
                const clickY = mouseY - rect.top;
                
                shoot(clickX, clickY, mouseX, mouseY);
            }
            
            hasMoved = false;
        });

        // æ»‘é¼ é»æ“Š - å¾æº–æ˜Ÿç•¶å‰ä½ç½®å°„æ“Š
        document.addEventListener('click', (e) => {
            if (!gameActive) return;
            
            // ä½¿ç”¨æº–æ˜Ÿç•¶å‰ä½ç½®ï¼Œè€Œä¸æ˜¯é»æ“Šä½ç½®
            const rect = canvas.getBoundingClientRect();
            const clickX = mouseX - rect.left;
            const clickY = mouseY - rect.top;
            
            shoot(clickX, clickY, mouseX, mouseY);
        });

        class Target {
            constructor() {
                this.size = 70 + Math.random() * 50;
                this.x = Math.random() * (canvas.width - this.size);
                this.y = canvas.height - 200 - Math.random() * 300;
                this.speedX = (Math.random() - 0.5) * 5;
                this.speedY = (Math.random() - 0.5) * 2.5;
                this.type = Math.random() > 0.5 ? 'dog' : 'cat';
                this.frame = 0;
                this.legPhase = Math.random() * Math.PI * 2;
                
                // éš¨æ©Ÿåˆ†é…åˆ†æ•¸ï¼ˆ60%æ©Ÿç‡æ˜¯åŠ åˆ†ï¼Œ40%æ©Ÿç‡æ˜¯æ‰£åˆ†ï¼‰
                const isPositive = Math.random() > 0.4;
                if (isPositive) {
                    // åŠ åˆ†ï¼š+1, +2, +3 çš„å…¶ä¸­ä¸€å€‹
                    const scores = [1, 2, 3];
                    this.scoreValue = scores[Math.floor(Math.random() * scores.length)];
                } else {
                    // æ‰£åˆ†ï¼š-1, -2 çš„å…¶ä¸­ä¸€å€‹
                    const scores = [-1, -2];
                    this.scoreValue = scores[Math.floor(Math.random() * scores.length)];
                }
                
                this.isGood = this.scoreValue > 0;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x + this.size/2, this.y + this.size/2);
                
                if (this.speedX < 0) {
                    ctx.scale(-1, 1);
                }

                if (this.type === 'dog') {
                    this.drawDog();
                } else {
                    this.drawCat();
                }
                
                ctx.restore();
                this.frame++;
                this.legPhase += 0.15;
            }

            drawDog() {
                const s = this.size;
                
                ctx.fillStyle = 'rgba(0,0,0,0.2)';
                ctx.ellipse(0, s/3 + 5, s/3, s/10, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = s/12;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(s/3.5, -s/15);
                const tailWag = Math.sin(this.frame / 4) * s/8;
                ctx.quadraticCurveTo(s/2, -s/4 + tailWag, s/2.2, s/12 + tailWag);
                ctx.stroke();
                
                const legMove = Math.sin(this.legPhase) * s/20;
                ctx.fillStyle = '#6B3410';
                ctx.fillRect(s/10, s/7, s/11, s/4 + legMove);
                ctx.fillRect(s/4, s/7, s/11, s/4 - legMove);
                
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.ellipse(0, 0, s/2.5, s/4, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#A0522D';
                ctx.beginPath();
                ctx.ellipse(-s/8, -s/12, s/8, s/10, -0.3, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(s/10, s/15, s/10, s/12, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#6B3410';
                ctx.fillRect(-s/4.5, s/7, s/11, s/4 - legMove);
                ctx.fillRect(-s/8, s/7, s/11, s/4 + legMove);
                
                ctx.fillStyle = '#4A2511';
                ctx.fillRect(s/10, s/2.8, s/9, s/15);
                ctx.fillRect(s/4, s/2.8, s/9, s/15);
                ctx.fillRect(-s/4.5, s/2.8, s/9, s/15);
                ctx.fillRect(-s/8, s/2.8, s/9, s/15);
                
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.ellipse(-s/3.5, -s/12, s/7, s/5.5, -0.5, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.ellipse(-s/2.5, -s/4, s/4.5, s/4, -0.2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#D2B48C';
                ctx.beginPath();
                ctx.ellipse(-s/2, -s/5, s/6, s/7, -0.3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#6B3410';
                ctx.beginPath();
                ctx.ellipse(-s/2, -s/2.8, s/9, s/5, -0.8, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(-s/3.2, -s/2.5, s/9, s/5, -0.3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#D2B48C';
                ctx.beginPath();
                ctx.ellipse(-s/2, -s/2.8, s/14, s/7, -0.8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(-s/3, -s/3.5, s/12, s/10, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(-s/3, -s/3.5, s/18, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(-s/2.8, -s/3.3, s/35, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#1a1a1a';
                ctx.beginPath();
                ctx.ellipse(-s/1.9, -s/5.5, s/15, s/12, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.beginPath();
                ctx.arc(-s/1.95, -s/5, s/30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#1a1a1a';
                ctx.lineWidth = s/60;
                ctx.beginPath();
                ctx.moveTo(-s/1.9, -s/6);
                ctx.lineTo(-s/1.9, -s/8);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(-s/2.1, -s/9, s/12, 0.2, 0.9);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(-s/1.75, -s/9, s/12, Math.PI - 0.9, Math.PI - 0.2);
                ctx.stroke();
                
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = s/20;
                ctx.beginPath();
                ctx.arc(-s/3.5, -s/10, s/6.5, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(-s/3.5, -s/18, s/20, 0, Math.PI * 2);
                ctx.fill();
            }

            drawCat() {
                const s = this.size;
                
                ctx.fillStyle = 'rgba(0,0,0,0.2)';
                ctx.ellipse(0, s/3 + 5, s/3, s/10, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#FF8C00';
                ctx.lineWidth = s/13;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(s/3.5, 0);
                const tailCurve = Math.sin(this.frame / 3) * s/6;
                ctx.bezierCurveTo(
                    s/2, -s/5 + tailCurve,
                    s/2.5, s/8 - tailCurve,
                    s/2.2, s/6 + Math.sin(this.frame / 3) * s/10
                );
                ctx.stroke();
                
                ctx.strokeStyle = '#CC6600';
                ctx.lineWidth = s/15;
                ctx.beginPath();
                ctx.moveTo(s/2.4, s/8);
                ctx.lineTo(s/2.2, s/6 + Math.sin(this.frame / 3) * s/10);
                ctx.stroke();
                
                const legMove = Math.sin(this.legPhase) * s/20;
                ctx.fillStyle = '#CC6600';
                ctx.fillRect(s/10, s/7, s/12, s/4 + legMove);
                ctx.fillRect(s/4.5, s/7, s/12, s/4 - legMove);
                
                ctx.fillStyle = '#FF8C00';
                ctx.beginPath();
                ctx.ellipse(0, 0, s/2.5, s/4.5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#CC6600';
                ctx.lineWidth = s/25;
                for (let i = 0; i < 4; i++) {
                    const offset = -s/6 + i * s/8;
                    ctx.beginPath();
                    ctx.arc(offset, 0, s/5, -Math.PI/3, Math.PI/3);
                    ctx.stroke();
                }
                
                ctx.fillStyle = '#CC6600';
                ctx.fillRect(-s/4.5, s/7, s/12, s/4 - legMove);
                ctx.fillRect(-s/7.5, s/7, s/12, s/4 + legMove);
                
                ctx.fillStyle = '#FFC0CB';
                ctx.beginPath();
                ctx.arc(s/10 + s/24, s/2.6, s/18, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(s/4.5 + s/24, s/2.6, s/18, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(-s/4.5 + s/24, s/2.6, s/18, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(-s/7.5 + s/24, s/2.6, s/18, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#FF8C00';
                ctx.beginPath();
                ctx.ellipse(-s/3.5, -s/10, s/6.5, s/5, -0.3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#FF8C00';
                ctx.beginPath();
                ctx.ellipse(-s/2.5, -s/3.5, s/4, s/3.5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#FF8C00';
                ctx.beginPath();
                ctx.moveTo(-s/2.2, -s/2);
                ctx.lineTo(-s/2.8, -s/1.5);
                ctx.lineTo(-s/3.2, -s/2);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(-s/3.8, -s/2);
                ctx.lineTo(-s/3.3, -s/1.5);
                ctx.lineTo(-s/2.9, -s/2);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = '#FFC0CB';
                ctx.beginPath();
                ctx.moveTo(-s/2.4, -s/2);
                ctx.lineTo(-s/2.7, -s/1.6);
                ctx.lineTo(-s/3, -s/2);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(-s/3.6, -s/2);
                ctx.lineTo(-s/3.4, -s/1.6);
                ctx.lineTo(-s/3.1, -s/2);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(-s/2.8, -s/4.5, s/7, s/6, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(-s/2.2, -s/4.5, s/7, s/6, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(-s/2.5, -s/5, s/6, s/7, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(-s/3.2, -s/3.2, s/9, s/8, -0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(-s/2.2, -s/3.2, s/9, s/8, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#32CD32';
                ctx.beginPath();
                ctx.ellipse(-s/3.2, -s/3.2, s/14, s/11, -0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(-s/2.2, -s/3.2, s/14, s/11, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'black';
                ctx.fillRect(-s/3.2 - s/60, -s/3.2 - s/16, s/30, s/8);
                ctx.fillRect(-s/2.2 - s/60, -s/3.2 - s/16, s/30, s/8);
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(-s/3.1, -s/3, s/30, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(-s/2.1, -s/3, s/30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#FFC0CB';
                ctx.beginPath();
                ctx.moveTo(-s/2.5, -s/5.5);
                ctx.lineTo(-s/2.7, -s/6);
                ctx.lineTo(-s/2.3, -s/6);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = '#FF99B8';
                ctx.beginPath();
                ctx.moveTo(-s/2.5, -s/5.5);
                ctx.lineTo(-s/2.6, -s/5.8);
                ctx.lineTo(-s/2.4, -s/5.8);
                ctx.closePath();
                ctx.fill();
                
                ctx.strokeStyle = '#1a1a1a';
                ctx.lineWidth = s/60;
                ctx.beginPath();
                ctx.moveTo(-s/2.5, -s/6);
                ctx.lineTo(-s/2.5, -s/7);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(-s/2.7, -s/7.5, s/14, 0.3, 1.2);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(-s/2.3, -s/7.5, s/14, Math.PI - 1.2, Math.PI - 0.3);
                ctx.stroke();
                
                ctx.strokeStyle = '#1a1a1a';
                ctx.lineWidth = s/80;
                ctx.beginPath();
                ctx.moveTo(-s/3.5, -s/5);
                ctx.lineTo(-s/2, -s/5.2);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(-s/3.5, -s/5.5);
                ctx.lineTo(-s/2, -s/5.5);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(-s/3.5, -s/6);
                ctx.lineTo(-s/2, -s/5.8);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(-s/1.5, -s/5);
                ctx.lineTo(-s/3, -s/5.2);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(-s/1.5, -s/5.5);
                ctx.lineTo(-s/3, -s/5.5);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(-s/1.5, -s/6);
                ctx.lineTo(-s/3, -s/5.8);
                ctx.stroke();
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (this.x < 0 || this.x > canvas.width - this.size) {
                    this.speedX *= -1;
                }
                if (this.y < canvas.height - 550 || this.y > canvas.height - 120) {
                    this.speedY *= -1;
                }
            }

            isHit(mx, my) {
                const centerX = this.x + this.size / 2;
                const centerY = this.y + this.size / 2;
                const distance = Math.sqrt((mx - centerX) ** 2 + (my - centerY) ** 2);
                return distance < this.size / 2.5;
            }
        }

        function spawnTargets() {
            targets = [];
            for (let i = 0; i < 6; i++) {
                targets.push(new Target());
            }
        }

        function drawSky() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.5, '#B0D8F0');
            gradient.addColorStop(1, '#98D8C8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            drawCloud(150, 80, 1);
            drawCloud(450, 120, 0.8);
            drawCloud(750, 60, 1.2);
            drawCloud(canvas.width - 200, 100, 0.9);
        }

        function drawCloud(x, y, scale) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.beginPath();
            ctx.arc(0, 0, 30, 0, Math.PI * 2);
            ctx.arc(40, -5, 35, 0, Math.PI * 2);
            ctx.arc(80, 0, 30, 0, Math.PI * 2);
            ctx.arc(40, 10, 30, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawGround() {
            const groundY = canvas.height - 100;
            
            const gradient = ctx.createLinearGradient(0, groundY, 0, canvas.height);
            gradient.addColorStop(0, '#90EE90');
            gradient.addColorStop(1, '#7CCD7C');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, groundY, canvas.width, 100);
            
            ctx.fillStyle = '#7CCD7C';
            for (let i = 0; i < canvas.width; i += 15) {
                const height = 8 + Math.random() * 12;
                const offset = Math.random() * 10;
                ctx.fillRect(i, groundY + offset, 2, height);
                ctx.fillRect(i + 5, groundY + offset + 3, 2, height - 3);
            }
            
            ctx.fillStyle = '#FFD700';
            for (let i = 0; i < 20; i++) {
                const fx = Math.random() * canvas.width;
                const fy = groundY + 10 + Math.random() * 30;
                ctx.beginPath();
                ctx.arc(fx, fy, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.fillStyle = '#FF69B4';
            for (let i = 0; i < 15; i++) {
                const fx = Math.random() * canvas.width;
                const fy = groundY + 15 + Math.random() * 30;
                ctx.beginPath();
                ctx.arc(fx, fy, 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawSky();
            drawGround();
            
            targets.forEach(target => {
                target.update();
                target.draw();
            });

            if (gameActive) {
                animationId = requestAnimationFrame(gameLoop);
            }
        }

        function startGame() {
            score = 0;
            timeLeft = 30;
            gameActive = true;
            document.getElementById('score').textContent = score;
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('endScreen').classList.remove('show');
            
            spawnTargets();
            gameLoop();
            
            const timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('endScreen').classList.add('show');
            
            let stars = 1;
            if (score >= 15) stars = 2;
            if (score >= 25) stars = 3;
            
            setTimeout(() => {
                for (let i = 1; i <= stars; i++) {
                    setTimeout(() => {
                        document.getElementById(`star${i}`).classList.add('filled');
                    }, i * 300);
                }
            }, 400);
        }

        function showHitEffect(x, y, scoreValue) {
            const effect = document.createElement('div');
            effect.className = 'hit-effect';
            if (scoreValue > 0) {
                effect.textContent = `+${scoreValue}`;
                effect.style.color = '#00FF00';
            } else {
                effect.textContent = `${scoreValue}`;
                effect.style.color = '#FF0000';
            }
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => effect.remove(), 600);
        }

        function showMissEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'miss-effect';
            effect.textContent = 'âœ—';
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => effect.remove(), 400);
        }

        function shoot(clickX, clickY, screenX, screenY) {
            muzzleFlash.classList.add('active');
            setTimeout(() => {
                muzzleFlash.classList.remove('active');
            }, 100);
            
            gun.style.transform = 'translateY(-15px) rotate(-2deg)';
            setTimeout(() => {
                gun.style.transform = 'translateY(0) rotate(0deg)';
            }, 150);
            
            let hit = false;
            for (let i = targets.length - 1; i >= 0; i--) {
                if (targets[i].isHit(clickX, clickY)) {
                    // æ ¹æ“šç›®æ¨™çš„åˆ†æ•¸å€¼å¢æ¸›åˆ†æ•¸
                    score += targets[i].scoreValue;
                    score = Math.max(0, score); // ç¢ºä¿åˆ†æ•¸ä¸æœƒè®Šæˆè² æ•¸
                    
                    document.getElementById('score').textContent = score;
                    showHitEffect(screenX, screenY, targets[i].scoreValue);
                    targets.splice(i, 1);
                    targets.push(new Target());
                    hit = true;
                    break;
                }
            }
            
            if (!hit) {
                showMissEffect(screenX, screenY);
            }
        }

        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', () => {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`star${i}`).classList.remove('filled');
            }
            startGame();
        });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        drawSky();
        drawGround();
        spawnTargets();
        targets.forEach(t => t.draw());
    </script>
</body>
</html>
                